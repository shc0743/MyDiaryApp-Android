<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>人机验证</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 400px;
                margin: 50px auto;
                padding: 40px;
                background: #FFFBFE;
            }
            #captchaCanvas {
                border: 1px solid #ddd;
                cursor: pointer;
                margin-bottom: 15px;
            }
            input {
                width: 200px;
                padding: 8px;
                margin-bottom: 15px;
            }
            button {
                padding: 8px 16px;
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
            #result {
                margin-top: 15px;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <canvas id="captchaCanvas" width="200" height="80"></canvas>
        <div>
            <input type="text" id="captchaInput" placeholder="请输入验证码">
        </div>
        <div>
            <button id="submitBtn">确定</button>
        </div>
        <div id="result"></div>

        <script>
            const canvas = document.getElementById('captchaCanvas');
            const ctx = canvas.getContext('2d');
            const captchaInput = document.getElementById('captchaInput');
            const submitBtn = document.getElementById('submitBtn');
            const resultDiv = document.getElementById('result');

            let currentCaptcha = '';

            function generateCaptcha() {
                const chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefghjkmnpqrstwxyz23456789';
                let captcha = '';
                for (let i = 0; i < 4; i++) {
                    captcha += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                currentCaptcha = captcha;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < captcha.length; i++) {
                    ctx.font = 'bold 30px Arial';
                    ctx.fillStyle = `rgb(${Math.random() * 100}, ${Math.random() * 100}, ${Math.random() * 100})`;
                    ctx.fillText(captcha[i], 30 + i * 40, 50);
                }

                for (let i = 0; i < 50; i++) {
                    ctx.beginPath();
                    ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 1, 0, 2 * Math.PI);
                    ctx.fillStyle = `rgba(${Math.random() * 255}, ${Math.random() * 255}, ${Math.random() * 255}, 0.6)`;
                    ctx.fill();
                }
            }

            canvas.addEventListener('click', generateCaptcha);

            submitBtn.addEventListener('click', function() {
                const userInput = captchaInput.value.trim();
                if (userInput === '') {
                    resultDiv.textContent = '请输入验证码';
                    resultDiv.style.color = 'red';
                } else if (userInput.toLowerCase() === currentCaptcha.toLowerCase()) {
                    resultDiv.textContent = '验证码正确';
                    resultDiv.style.color = 'green';
                    location.href = 'captchapass://a';
                } else {
                    resultDiv.textContent = '验证码错误';
                    resultDiv.style.color = 'red';
                    generateCaptcha();
                    captchaInput.value = '';
                }
            });

            generateCaptcha();
        </script>
    </body>
</html>